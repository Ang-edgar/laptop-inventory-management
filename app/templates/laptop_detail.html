{% extends "base.html" %}
{% block title %}Laptop Details{% endblock %}
{% block content %}
<div class="header">
    <h2>{{ laptop.laptop_name }} ({{ laptop.serial_number or laptop.id }})</h2>
</div>

<!-- Pricing Breakdown Card -->
<div class="card" style="max-width: 600px; margin: 2rem auto;">
    <div class="card-header">
        <h3><i class="fas fa-dollar-sign"></i> Pricing Breakdown</h3>
    </div>
    <div class="card-body">
        <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <div>
                <strong>Original Laptop Price:</strong><br>
                <span style="color: #6b7280;">Base laptop without upgrades</span>
            </div>
            <div style="text-align: right;">
                <strong style="font-size: 1.2rem; color: #4f46e5;">${{ "%.2f"|format(original_price) }}</strong>
            </div>
        </div>
        
        {% if upgrades_value > 0 %}
        <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; padding: 1rem; background: #ecfdf5; border-radius: 8px;">
            <div>
                <strong>Upgrades Value:</strong><br>
                <span style="color: #6b7280;">Total spare parts added</span>
            </div>
            <div style="text-align: right;">
                <strong style="font-size: 1.2rem; color: #059669;">+${{ "%.2f"|format(upgrades_value) }}</strong>
            </div>
        </div>
        {% endif %}
        
        <div style="display: flex; justify-content: space-between; padding: 1rem; background: #1e40af; color: white; border-radius: 8px; font-size: 1.1rem;">
            <div>
                <strong>Total Selling Price:</strong>
            </div>
            <div style="text-align: right;">
                <strong style="font-size: 1.3rem;">${{ "%.2f"|format(laptop.price_to_sell) }}</strong>
            </div>
        </div>
    </div>
</div>

<!-- Specs Card -->
<div class="card" style="max-width: 600px; margin: 2rem auto;">
    <div class="card-header">
        <h3>Specifications</h3>
    </div>
    <div class="card-body">
        <p><strong>CPU:</strong> {{ laptop.cpu }}</p>
        <p><strong>RAM:</strong> {{ laptop.ram }}</p>
        <p><strong>Storage:</strong> {{ laptop.storage }}</p>
        <p><strong>OS:</strong> {{ laptop.os }}</p>
        
        <!-- Images Section -->
        <div class="form-group" style="margin:1rem 0;">
            <label><strong>Images:</strong></label><br>
            {% if images %}
                <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                    {% for image in images %}
                    <div style="position: relative;">
                        <img src="{{ url_for('serve_specific_image', laptop_id=laptop.id, image_id=image.id) }}" 
                             alt="Laptop Image" 
                             style="max-width:200px; max-height:200px; border-radius:10px; box-shadow:0 2px 8px #ccc; cursor: pointer;"
                             onclick="openImageModal(this.src)">
                        {% if image.is_primary %}
                            <span style="position: absolute; top: 5px; left: 5px; background: #3b82f6; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: bold;">PRIMARY</span>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <span style="color:#aaa;">No images uploaded.</span>
            {% endif %}
        </div>
    </div>
</div>

<!-- Installed Spare Parts Card -->
<div class="card" style="max-width: 600px; margin: 2rem auto;">
    <div class="card-header">
        <h3><i class="fas fa-tools"></i> Installed Spare Parts</h3>
    </div>
    <div class="card-body">
        {% if installed_parts %}
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Specification</th>
                        <th>Capacity</th>
                        <th>Price Added</th>
                        <th>Date Added</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for part in installed_parts %}
                    <tr>
                        <td>
                            {% if part.part_type == 'Storage' %}
                                <i class="fas fa-hdd" style="color: #3b82f6;"></i> {{ part.part_type }}
                            {% elif part.part_type == 'RAM' %}
                                <i class="fas fa-memory" style="color: #10b981;"></i> {{ part.part_type }}
                            {% endif %}
                        </td>
                        <td>
                            {{ part.storage_type or part.ram_type }}
                            {% if part.ram_speed %}
                                <span style="color: #6b7280;">({{ part.ram_speed }})</span>
                            {% endif %}
                        </td>
                        <td><strong>{{ part.capacity }}</strong></td>
                        <td style="color: #059669; font-weight: bold;">${{ "%.2f"|format(part.price_at_time) }}</td>
                        <td style="font-size: 0.9rem; color: #6b7280;">{{ part.installed_date[:10] }}</td>
                        <td>
                            <form method="post" action="{{ url_for('remove_sparepart_from_laptop', laptop_id=laptop.id, sparepart_id=part.id) }}" style="display:inline;">
                                <button type="submit" class="btn btn-sm btn-danger" title="Remove Part" onclick="return confirm('Are you sure you want to remove this spare part? This will reduce the laptop price by ${{ part.price_at_time }}.')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr style="background: #f8f9fa; font-weight: bold;">
                        <td colspan="3" style="text-align: right;">Total Upgrades Value:</td>
                        <td style="color: #059669; font-size: 1.1rem;">${{ "%.2f"|format(upgrades_value) }}</td>
                        <td colspan="2"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 2rem; color: #6b7280;">
            <i class="fas fa-tools" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
            <p>No spare parts installed yet.</p>
            <p style="font-size: 0.9rem;">Add components to enhance this laptop's capabilities.</p>
        </div>
        {% endif %}
        
        <div style="margin-top: 1.5rem; text-align: center;">
            <a href="{{ url_for('add_sparepart_to_laptop', laptop_id=laptop.id) }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add Spare Part
            </a>
            <a href="{{ url_for('admin_panel') }}" class="btn btn-outline" style="margin-left: 1rem;">
                <i class="fas fa-arrow-left"></i> Back to Inventory
            </a>
        </div>
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8);" onclick="closeImageModal()">
    <div style="position: relative; margin: auto; padding: 20px; width: 90%; max-width: 800px; top: 50%; transform: translateY(-50%);">
        <img id="modalImage" style="width: 100%; height: auto; border-radius: 10px;">
        <span style="position: absolute; top: 10px; right: 25px; color: white; font-size: 35px; font-weight: bold; cursor: pointer;" onclick="closeImageModal()">&times;</span>
    </div>
</div>

<script>
function openImageModal(src) {
    document.getElementById('imageModal').style.display = 'block';
    document.getElementById('modalImage').src = src;
}

function closeImageModal() {
    document.getElementById('imageModal').style.display = 'none';
}

// Close modal when clicking outside the image
document.getElementById('imageModal').onclick = function(event) {
    if (event.target === this) {
        closeImageModal();
    }
}
</script>
{% endblock %}