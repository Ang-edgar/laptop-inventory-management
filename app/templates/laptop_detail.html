{% extends "base.html" %}
{% block title %}Laptop Details{% endblock %}
{% block content %}
<div class="header">
    <h2>{{ laptop.laptop_name }}</h2>
</div>
<div class="card" style="max-width: 600px; margin: 2rem auto;">
    <div class="card-header">
        <h3>Specs</h3>
    </div>
    <div class="card-body">
        <p><strong>CPU:</strong> {{ laptop.cpu }}</p>
        <p><strong>RAM:</strong> {{ laptop.ram }}</p>
        <p><strong>Storage:</strong> {{ laptop.storage }}</p>
        
        <!-- Images Section -->
        <div class="form-group" style="margin:1rem 0;">
            <label><strong>Images:</strong></label><br>
            {% if images %}
                <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                    {% for image in images %}
                    <div style="position: relative;">
                        <img src="{{ url_for('serve_specific_image', laptop_id=laptop.id, image_id=image.id) }}" 
                             alt="Laptop Image" 
                             style="max-width:200px; max-height:200px; border-radius:10px; box-shadow:0 2px 8px #ccc; cursor: pointer;"
                             onclick="openImageModal(this.src)">
                        {% if image.is_primary %}
                            <span style="position: absolute; top: 5px; left: 5px; background: #3b82f6; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: bold;">PRIMARY</span>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <span style="color:#aaa;">No images uploaded.</span>
            {% endif %}
        </div>
    </div>
</div>

<!-- Installed Spare Parts Card -->
<div class="card" style="max-width: 600px; margin: 2rem auto;">
    <div class="card-header">
        <h3><i class="fas fa-tools"></i> Installed Spare Parts</h3>
    </div>
    <div class="card-body">
        {% if installed_parts %}
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Specification</th>
                        <th>Capacity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for part in installed_parts %}
                    <tr>
                        <td>
                            {% if part.part_type == 'Storage' %}
                                <i class="fas fa-hdd" style="color: #3b82f6;"></i> {{ part.part_type }}
                            {% elif part.part_type == 'RAM' %}
                                <i class="fas fa-memory" style="color: #10b981;"></i> {{ part.part_type }}
                            {% endif %}
                        </td>
                        <td>
                            {{ part.storage_type or part.ram_type }}
                            {% if part.ram_speed %}
                                <span style="color: #6b7280;">({{ part.ram_speed }})</span>
                            {% endif %}
                        </td>
                        <td><strong>{{ part.capacity }}</strong></td>
                        <td>
                            <form method="post" action="{{ url_for('remove_sparepart_from_laptop', laptop_id=laptop.id, sparepart_id=part.id) }}" style="display:inline;">
                                <button type="submit" class="btn btn-sm btn-danger" title="Remove Part" onclick="return confirm('Are you sure you want to remove this spare part?')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 2rem; color: #6b7280;">
            <i class="fas fa-tools" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
            <p>No spare parts installed yet.</p>
            <p style="font-size: 0.9rem;">Add components to enhance this laptop's capabilities.</p>
        </div>
        {% endif %}
        
        <div style="margin-top: 1.5rem; text-align: center;">
            <a href="{{ url_for('add_sparepart_to_laptop', laptop_id=laptop.id) }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add from Spare Parts
            </a>
            <a href="{{ url_for('index') }}" class="btn btn-outline" style="margin-left: 1rem;">
                <i class="fas fa-arrow-left"></i> Back to Inventory
            </a>
        </div>
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8);" onclick="closeImageModal()">
    <div style="position: relative; margin: auto; padding: 20px; width: 90%; max-width: 800px; top: 50%; transform: translateY(-50%);">
        <img id="modalImage" style="width: 100%; height: auto; border-radius: 10px;">
        <span style="position: absolute; top: 10px; right: 25px; color: white; font-size: 35px; font-weight: bold; cursor: pointer;" onclick="closeImageModal()">&times;</span>
    </div>
</div>

<script>
function openImageModal(src) {
    document.getElementById('imageModal').style.display = 'block';
    document.getElementById('modalImage').src = src;
}

function closeImageModal() {
    document.getElementById('imageModal').style.display = 'none';
}

// Close modal when clicking outside the image
document.getElementById('imageModal').onclick = function(event) {
    if (event.target === this) {
        closeImageModal();
    }
}
</script>
{% endblock %}